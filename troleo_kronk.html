<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa SVG coloreado (HTML + JS)</title>
  <style>
    body { margin: 0; font-family: system-ui, sans-serif; background:#111; color:#eee; }
    #wrapper { display: grid; grid-template-columns: 1fr 280px; min-height: 100vh; }
    #map { display:flex; align-items:center; justify-content:center; background:#161616; }
    #panel { padding:16px; border-left:1px solid #2a2a2a; }
    .legend { height: 12px; background: linear-gradient(to right, #440154, #3b528b, #21918c, #5ec962, #fde725); border-radius: 6px; margin: 8px 0 16px; }
    .row { display:flex; align-items:center; gap:8px; margin:6px 0; }
    .chip { width:14px; height:14px; border-radius:3px; border:1px solid #0003; }
    svg { max-width: 100%; height: auto; }
    .region { cursor: pointer; transition: filter .15s ease; }
    .region:hover { filter: brightness(1.15); }
    #tooltip {
      position: fixed; pointer-events: none; background: rgba(0,0,0,.8); color: #fff;
      padding: 6px 8px; border-radius: 6px; font-size: 12px; transform: translate(8px, -8px);
      opacity: 0; transition: opacity .1s ease;
    }
  </style>
</head>
<body>
<div id="wrapper">
  <div id="map">
    <!-- Aquí inyectaremos el SVG -->
    <div id="svg-host"></div>
  </div>
  <aside id="panel">
    <h2 style="margin:0 0 6px;">Mapa desde SVG</h2>
    <div>Coloreado por valor (escala tipo Viridis)</div>
    <div class="legend" title="Bajo → Alto"></div>

    <div class="row">
      <label for="min">Mín:</label>
      <input id="min" type="number" step="any" value="0" style="width:100px">
    </div>
    <div class="row">
      <label for="max">Máx:</label>
      <input id="max" type="number" step="any" value="100" style="width:100px">
    </div>
    <button id="repaint">Re-colorear</button>

    <p style="opacity:.8; margin-top:16px;">Tip: cambia los valores en <code>dataById</code> para tus datos reales.</p>
  </aside>
</div>

<div id="tooltip"></div>

<script>
  // 1) Tus datos por ID del SVG (ajusta claves y valores)
  //    Las claves deben coincidir con atributos id de <path>, <polygon>, <g>, etc.
  const dataById = {
    // "Region_1": 12.3,
    // "Region_2": 35.0,
    // "Region_3": 78.9,
    // Ejemplo genérico; cuando no haya valor, no se colorea
  };

  // 2) Rango de valores (ajustable en el panel)
  let vmin = 0, vmax = 100;

  // 3) Pequeño sampler de escala tipo Viridis (aproximada) en hex
  const viridis = [
    "#440154", "#482878", "#3e4989", "#31688e", "#26828e",
    "#1f9e89", "#35b779", "#6ece58", "#b5de2b", "#fde725"
  ];
  function sampleViridis(t) {
    t = Math.min(1, Math.max(0, t));
    const n = viridis.length - 1;
    const i = Math.floor(t * n);
    const frac = (t * n) - i;
    const c1 = hexToRgb(viridis[i]), c2 = hexToRgb(viridis[Math.min(i+1, n)]);
    const r = Math.round(c1.r + (c2.r - c1.r) * frac);
    const g = Math.round(c1.g + (c2.g - c1.g) * frac);
    const b = Math.round(c1.b + (c2.b - c1.b) * frac);
    return `rgb(${r},${g},${b})`;
  }
  function hexToRgb(hex) {
    const h = hex.replace("#",""); 
    return { r: parseInt(h.slice(0,2),16), g: parseInt(h.slice(2,4),16), b: parseInt(h.slice(4,6),16) };
  }
  function norm(v, vmin, vmax) {
    if (v == null || isNaN(v)) return null;
    if (vmax === vmin) return 0.5;
    return (v - vmin) / (vmax - vmin);
  }

  // 4) Cargar e inyectar el SVG
  const svgHost = document.getElementById("svg-host");
  const tooltip = document.getElementById("tooltip");

  fetch("cl.svg")
    .then(r => r.text())
    .then(xml => {
      svgHost.innerHTML = xml;
      const svg = svgHost.querySelector("svg");
      if (!svg) throw new Error("No se encontró <svg> en cl.svg");

      // Añade clase común a regiones (paths / polygons / etc.)
      const targets = svg.querySelectorAll("path, polygon, rect, circle, ellipse");
      targets.forEach(el => el.classList.add("region"));

      // Colorear inicial
      readRange();
      paint();

      // Tooltip básico
      targets.forEach(el => {
        el.addEventListener("mousemove", (e) => {
          const id = el.getAttribute("id") || "(sin id)";
          const v = dataById[id];
          tooltip.textContent = `${id}${(v!=null)? ` — ${v}` : ""}`;
          tooltip.style.left = e.clientX + "px";
          tooltip.style.top = e.clientY + "px";
          tooltip.style.opacity = 1;
        });
        el.addEventListener("mouseleave", () => {
          tooltip.style.opacity = 0;
        });
      });
    })
    .catch(err => {
      svgHost.innerHTML = `<pre style="color:#f55">Error cargando SVG: ${err.message}</pre>`;
    });

  function readRange() {
    const minEl = document.getElementById("min");
    const maxEl = document.getElementById("max");
    vmin = parseFloat(minEl.value);
    vmax = parseFloat(maxEl.value);
  }

  function paint() {
    const svg = svgHost.querySelector("svg");
    if (!svg) return;

    // Recorremos elementos "pintables"
    const targets = svg.querySelectorAll(".region");
    targets.forEach(el => {
      const id = el.getAttribute("id");
      const v = id ? dataById[id] : null;
      if (v == null || isNaN(v)) {
        // sin dato → estilo por defecto (puedes poner un gris)
        el.style.fill = "#2b2b2b";
        el.style.stroke = "rgba(0,0,0,.35)";
        el.style.strokeWidth = "0.5";
      } else {
        const t = norm(v, vmin, vmax);
        const color = sampleViridis(t);
        el.style.fill = color;
        el.style.stroke = "rgba(0,0,0,.5)";
        el.style.strokeWidth = "0.5";
      }
    });
  }

  // Botón para re-colorear cuando cambies min/max o dataById
  document.getElementById("repaint").addEventListener("click", () => {
    readRange();
    paint();
  });

  // ====== EJEMPLO: asignar datos aleatorios (bórralo y usa tus datos) ======
  // Cuando ya conozcas los IDs reales del SVG, llena dataById con tus valores.
  // Aquí dejamos un ejemplo de cómo poblarlo automáticamente:
  // (Descomenta para probar)
  /*
  setTimeout(() => {
    const all = (svgHost.querySelectorAll("svg [id]"));
    all.forEach((el, i) => {
      const id = el.getAttribute("id");
      // Solo asignamos a elementos con geometría
      if (["PATH","POLYGON","RECT","CIRCLE","ELLIPSE"].includes(el.tagName)) {
        dataById[id] = Math.round(Math.random()*100);
      }
    });
    paint();
  }, 500);
  */
</script>
</body>
</html>
